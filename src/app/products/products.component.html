<div class="products-container">
  <div class="products-header">
    <h1>Patrimônios e Solicitações</h1>
    <p>Gerencie solicitações de patrimônios no sistema</p>
  </div>

  <!-- Navegação -->
  <nav class="products-nav">
    <button
      (click)="currentSection = 'create'"
      [class.active]="currentSection === 'create'"
      class="nav-btn"
    >
      <span class="material-icons">add</span>
      Nova Solicitação
    </button>
    <button
      (click)="currentSection = 'my-requests'"
      [class.active]="currentSection === 'my-requests'"
      class="nav-btn"
    >
      <span class="material-icons">list</span>
      Minhas Solicitações
    </button>
    <button
      (click)="showAllRequests()"
      [class.active]="currentSection === 'all-requests'"
      class="nav-btn"
    >
      <span class="material-icons">visibility</span>
      Todas as Solicitações
    </button>
    <button
      *ngIf="isAdmin"
      (click)="currentSection = 'pending'"
      [class.active]="currentSection === 'pending'"
      class="nav-btn"
    >
      <span class="material-icons">pending_actions</span>
      Pendentes ({{ pendingRequests.length }})
    </button>
  </nav>

  <!-- Conteúdo -->
  <div class="products-content">
    <!-- Nova Solicitação -->
    <section *ngIf="currentSection === 'create'" class="section-content">
      <h2>Nova Solicitação de Patrimônio</h2>

      <div class="form-container">
        <div class="form-row">
          <div class="form-group">
            <label>Patrimônio</label>
            <select [(ngModel)]="newRequest.patrimonio_id" class="form-select" required>
              <option value="">Selecione um patrimônio</option>
              <option *ngFor="let patrimonio of patrimonios" [value]="patrimonio.patrimonio_id">
                {{ patrimonio.name }} - Estoque: {{ patrimonio.estoque }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>Tipo de Solicitação</label>
            <select [(ngModel)]="newRequest.tipo" class="form-select" required>
              <option *ngFor="let tipo of tiposSolicitacao" [value]="tipo.value">
                {{ tipo.label }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-group full-width">
          <label>Observações</label>
          <textarea
            [(ngModel)]="newRequest.observacao"
            placeholder="Descreva detalhadamente a necessidade e justificativa..."
            rows="6"
            class="form-textarea"
          ></textarea>
        </div>

        <div class="form-actions">
          <button
            (click)="createRequest()"
            class="btn-primary"
            [disabled]="!newRequest.patrimonio_id || !newRequest.tipo"
          >
            <span class="material-icons">send</span>
            Enviar Solicitação
          </button>
        </div>
      </div>
    </section>

    <!-- Minhas Solicitações -->
    <section *ngIf="currentSection === 'my-requests'" class="section-content">
      <h2>Minhas Solicitações</h2>

      <div class="requests-grid">
        <div *ngFor="let request of myRequests" class="request-card">
          <div class="request-header">
            <h3>{{ getPatrimonioNome(request.patrimonio_id) }}</h3>
            <div class="request-meta">
              <span class="request-category">{{ getTipoText(request.tipo) }}</span>
              <span
                class="request-status"
                [class]="getStatusClass(request.status)"
              >
                {{ getStatusText(request.status) }}
              </span>
            </div>
          </div>

          <div class="request-info">
            <span class="material-icons">calendar_today</span>
            {{ request.created_at | date : "dd/MM/yyyy" }}
            <span class="material-icons">category</span>
            Tipo: {{ request.tipo }}
          </div>

          <p class="request-content">{{ request.observacao || 'Sem observações' }}</p>

          <div class="request-actions">
            <button
              *ngIf="request.status === 'pending' || !request.status"
              (click)="deleteRequest(request.solicitacao_id!)"
              class="btn-danger"
            >
              <span class="material-icons">delete</span>
              Cancelar
            </button>
          </div>
        </div>
      </div>

      <div *ngIf="myRequests.length === 0" class="empty-state">
        <span class="material-icons">inventory_2</span>
        <h3>Nenhuma solicitação encontrada</h3>
        <p>Você ainda não criou nenhuma solicitação.</p>
      </div>
    </section>

    <!-- Todas as Solicitações -->
    <section *ngIf="currentSection === 'all-requests'" class="section-content">
      <h2>Todas as Solicitações</h2>

      <div class="requests-grid">
        <div *ngFor="let request of allRequests" class="request-card">
          <div class="request-header">
            <h3>{{ getPatrimonioNome(request.patrimonio_id) }}</h3>
            <div class="request-meta">
              <span class="request-category">{{ getTipoText(request.tipo) }}</span>
              <span
                class="request-status"
                [class]="getStatusClass(request.status)"
              >
                {{ getStatusText(request.status) }}
              </span>
            </div>
          </div>

          <div class="request-info">
            <span class="material-icons">person</span>
            Usuário ID: {{ request.user_id }}
            <span class="material-icons">calendar_today</span>
            {{ request.created_at | date : "dd/MM/yyyy" }}
            <span class="material-icons">category</span>
            Tipo: {{ request.tipo }}
          </div>

          <p class="request-content">{{ request.observacao || 'Sem observações' }}</p>
        </div>
      </div>
    </section>

    <!-- Solicitações Pendentes -->
    <section
      *ngIf="currentSection === 'pending' && isAdmin"
      class="section-content"
    >
      <h2>Solicitações Pendentes</h2>

      <div class="requests-grid">
        <div
          *ngFor="let request of pendingRequests"
          class="request-card pending"
        >
          <div class="request-header">
            <h3>{{ getPatrimonioNome(request.patrimonio_id) }}</h3>
            <div class="request-meta">
              <span class="request-category">{{ getTipoText(request.tipo) }}</span>
              <span class="request-status status-pending">Pendente</span>
            </div>
          </div>

          <div class="request-info">
            <span class="material-icons">person</span>
            Usuário ID: {{ request.user_id }}
            <span class="material-icons">calendar_today</span>
            {{ request.created_at | date : "dd/MM/yyyy" }}
            <span class="material-icons">category</span>
            Tipo: {{ request.tipo }}
          </div>

          <p class="request-content">{{ request.observacao || 'Sem observações' }}</p>

          <div class="request-actions">
            <button (click)="approveRequest(request.solicitacao_id!)" class="btn-primary">
              <span class="material-icons">check</span>
              Aprovar
            </button>
            <button (click)="rejectRequest(request.solicitacao_id!)" class="btn-danger">
              <span class="material-icons">close</span>
              Rejeitar
            </button>
          </div>
        </div>
      </div>

      <div *ngIf="pendingRequests.length === 0" class="empty-state">
        <span class="material-icons">check_circle</span>
        <h3>Nenhuma solicitação pendente</h3>
        <p>Todas as solicitações foram revisadas.</p>
      </div>
    </section>
  </div>
</div>